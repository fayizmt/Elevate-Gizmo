<%-include ('../layouts/adminHeader.ejs') %>
    <div class="screen-overlay"></div>
   

        <%-include ('../layouts/adminSideBar.ejs') %>
    </aside>
    <main class="main-wrap">
        <header class="main-header navbar navbar-expand-lg navbar-light bg-light">
            <div class="container">
                <div class="head-title">
                    <div class="left">
                        <h1>Products</h1>
                    </div>
                </div>

                <div class="col-nav ml-auto">
                    <button class="btn btn-icon btn-mobile" data-trigger="#offcanvas_aside">
                        <i class="material-icons md-apps"></i>
                    </button>
                    <ul class="nav">
                        <li class="nav-item">
                            <a class="nav-link btn-icon" href="#">
                                <i class="material-icons md-notifications animation-shake"></i>
                                <span class="badge rounded-pill">3</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link btn-icon darkmode" href="#">
                                <i class="material-icons md-nights_stay"></i>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="requestfullscreen nav-link btn-icon">
                                <i class="material-icons md-cast"></i>
                            </a>
                        </li>
                        <li class="dropdown nav-item">
                            <a class="dropdown-toggle" data-bs-toggle="dropdown" href="#" id="dropdownLanguage"
                                aria-expanded="false"><i class="material-icons md-/public"></i></a>
                            <div class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownLanguage">
                                <a class="dropdown-item text-brand" href="#"><img
                                        src="/admin/imgs/theme/flag-us.png" alt="English" />English</a>
                                <a class="dropdown-item" href="#"><img src="/admin/imgs/theme/flag-fr.png"
                                        alt="Français" />Français</a>
                                <a class="dropdown-item" href="#"><img src="/admin/imgs/theme/flag-jp.png"
                                        alt="Français" />日本語</a>
                                <a class="dropdown-item" href="#"><img src="/admin/imgs/theme/flag-cn.png"
                                        alt="Français" />中国人</a>
                            </div>
                        </li>
                        <li class="dropdown nav-item">
                            <a class="dropdown-toggle" data-bs-toggle="dropdown" href="#" id="dropdownAccount"
                                aria-expanded="false"> <img class="img-xs rounded-circle"
                                    src="/admin/imgs/people/avatar-2.png" alt="User" /></a>
                            <div class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownAccount">
                                <a class="dropdown-item" href="#"><i class="material-icons md-perm_identity"></i>Edit
                                    Profile</a>
                                <a class="dropdown-item" href="#"><i class="material-icons md-settings"></i>Account
                                    Settings</a>
                                <a class="dropdown-item" href="#"><i
                                        class="material-icons md-account_balance_wallet"></i>Wallet</a>
                                <a class="dropdown-item" href="#"><i class="material-icons md-receipt"></i>Billing</a>
                                <a class="dropdown-item" href="#"><i class="material-icons md-help_outline"></i>Help
                                    center</a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item text-danger" href="#"><i
                                        class="material-icons md-exit_to_app"></i>Logout</a>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </header>



        <section class="content-main">
            <div class="container-fluid">
                <div class="left">
                    <a href="addproduct" class="btn btn-success btn-download">
                        <i class='bx bxs-plus-circle'></i>
                        <span class="text">Add New product</span>
                    </a>
                </div>
                
                <div class="card mt-4">
                    <div class="table-data">
                        <div class="order">
                            <!-- if(products.length> 0)  -->
                                <div class="table-responsive">
                                    <table id="tablePagination" class="table table-bordered table-hover table-striped">
                                        <thead class="thead-dark">
                                            <tr>
                                                <th scope="col">
                                                    <center>Sl.No.</center>
                                                </th>
                                                <th scope="col">
                                                    <center>Image</center>
                                                </th>
                                                <th scope="col">
                                                    <center>Name</center>
                                                </th>
                                                <th scope="col">
                                                    <center>Quantity</center>
                                                </th>
                                                <th scope="col">
                                                    <center>Category</center>
                                                </th>
                                                <th scope="col">
                                                    <center>Price</center>
                                                </th>
                                                <th scope="col">
                                                    <center>Update</center>
                                                </th>
                                                <th scope="col">
                                                    <center>List / Unlist</center>
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <% for(let i = 0; i < productList.length; i++) { %>
                                                <tr>
                                                    <td align="center"><%= i + 1 %></td>
                                                    <td align="center">
                                                        <img src="/images/products/<%= productList[i].images[0] %>" style="max-width: 30px; max-height: 30px;" alt="">
                                                    </td>
                                                    <td align="center"><%= productList[i].productName %></td>
                                                    <td align="center"><%= productList[i].quantity %></td>
                                                    <td align="center"><%= productList[i].category.category %></td>
                                                    <td align="center"><%= productList[i].price %></td>
                                                    <td align="center"><a href="/admin/editproduct?id=<%= productList[i]._id %>">edit</a></td>
                                                    <td align="center">
                                                        <% if (productList[i].is_block) { %>
                                                            <a class="block-unblock-product" data-product-id="<%= productList[i]._id %>" data-action="unblock">
                                                                <span class="badge rounded-pill alert-success">unblock</span>
                                                            </a>
                                                        <% } else { %>
                                                            <a class="block-unblock-product" data-product-id="<%= productList[i]._id %>" data-action="block">
                                                                <span class="badge rounded-pill alert-danger">block</span>
                                                            </a>
                                                        <% } %>
                                                    </td>
                                                </tr>
                                            <% } %>
                                        </tbody>
                                        
                                        
                                    </table>
                                    
                                </div>
                               
        
                        </div>
                    </div>
                </div>
            </div>
        </section>

        
            <script>
    document.addEventListener('DOMContentLoaded', () => {
        const blockUnblockLinks = document.querySelectorAll('.block-unblock-product');

        blockUnblockLinks.forEach(link => {
            link.addEventListener('click', async (event) => {
                event.preventDefault();

                const productId = event.currentTarget.getAttribute('data-product-id');
                const action = event.currentTarget.getAttribute('data-action');

                try {
                    const response = await fetch('/admin/product', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ productId, action })
                    });

                    const result = await response.json();
                    if (result.success) {
                        location.reload();
                    } else {
                        alert('Failed to update product status');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('Failed to update product status');
                }
            });
        });
    });
</script>

        
        

        <!-- content-main end// -->
        <%-include ('../layouts/adminFooter.ejs') %>
