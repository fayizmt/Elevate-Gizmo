<!-- <%-include ('../layouts/userHeader.ejs') %> -->


<!-- Start Header Section -->
<!-- <header>
    <div class="header-top">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <ul class="header_list text-md-left text-center">
                        <li><a href="tel:+ 00 123 456 789"><i class="fa fa-phone"></i>+ 00 123 456 789</a></li>
                        <li><a href="mailto:info@gmail.com"><i class="fa fa-envelope-o"></i>info@gmail.com</a></li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <ul class="header_list text-md-right text-center">
                        <li><a href="#test-popup1" class="open-popup-link">Login</a>
                            <div id="test-popup1" class="white-popup lr-popup mfp-hide text-center">
                                <h4>Login</h4>
                                <form class="subscribe-popup-form" method="post" action="#">
                                    <input name="email" required type="email" placeholder="Enter Your Email">
                                    <input name="password" required type="password" placeholder="Enter Your Password">
                                    <div class="form-check text-left">
                                        <label>Remember me
                                            <input class="defult-check" type="checkbox" checked="checked">
                                            <span class="checkmark"></span>
                                        </label>
                                        <a href="#" class="forgot-password float-right">Forgot Password ?</a>
                                    </div>
                                    <button class="btn btn-primary" title="Login" type="button">Login</button>
                                </form>
                                <h6>Don't have an account?</h6>
                                <a href="#test-popup2" class="sign-up open-popup-link">Click here to Sign up</a>
                            </div>  
                            <div id="test-popup2" class="white-popup lr-popup mfp-hide">
                                <h4>Registration</h4>
                                <form class="subscribe-popup-form" method="post" action="#">
                                    <input name="input" required type="input" placeholder="Enter Your name">
                                    <input name="email" required type="email" placeholder="Enter Your Email">
                                    <input name="password" required type="password" placeholder="Enter Your Password">
                                    <input name="password" required type="password" placeholder="Confirmation Password">
                                    <div class="form-check">
                                        <label>I accept the terms and conditions
                                            <input class="defult-check" type="checkbox" checked="checked">
                                            <span class="checkmark"></span>
                                        </label>
                                    </div>
                                    <button class="btn btn-primary" title="Subscribe" type="button">Register</button>
                                </form>
                            </div>
                        </li>
                        <li><a href="/wishlist">Wishlist</a></li>
                        <li><a href="my-account.html">My Account</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="header-mdl">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <div class="hm-inner d-sm-flex align-items-center justify-content-between">
                        <div class="header-logo">
                            <a href="index.html"><img src="image/logo.png" alt="logo"></a>
                        </div>
                        <form class="header-form">
                        <input class="search-box" placeholder="Search Product..."  required value="" type="search">
                        <button type="submit">Search</button>
                    </form>
                        <div class="header-right">
                            <div class="header-cart">
                            <a href="#">
                                <div class="cart-icon">
                                    <img src="/user/image/cart-icon.png" alt="cart-icon">
                                    <span>02</span>
                                </div>
                                $237.00<i class="fa fa-angle-down"></i>
                            </a>
                            <div class="cart-box">
                                <div class="cart-info">
                                <div class="cart-prodect d-flex">
                                    <div class="cart-img">
                                        <img src="image/cart-img-1.png" alt="cart-img">
                                    </div>
                                    <div class="cart-product">
                                        <a href="#">Ornare sed consequat</a>
                                        <p>$ 81.00</p>
                                    </div>
                                    <a href="#" class="close-icon d-flex align-items-center"><i class="ion-close"></i></a>
                                </div>
                                <div class="cart-prodect d-flex">
                                    <div class="cart-img">
                                        <img src="image/cart-img-2.png" alt="cart-img">
                                    </div>
                                    <div class="cart-product">
                                        <a href="#">Pellentesque posuere</a>
                                        <p>$ 80.00</p>
                                    </div>
                                    <a href="#" class="close-icon d-flex align-items-center"><i class="ion-close"></i></a>
                                </div>
                            </div>
                                <div class="price-prodect d-flex align-items-center justify-content-between">
                                <p class="total">total</p>
                                <p class="total-price">$ 161.00</p>
                            </div>
                                <div class="cart-btn">
                                <a href="cart.html" class="btn btn-primary">View Cart</a>
                            </div>
                            </div>
                        </div>
                            <div class="d-lg-none mm_icon">
                                <div class="form-captions" id="search">
                                    <button type="submit" class="submit-btn-2"><i class="fa fa-search"></i></button>
                                </div>
                                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><i class="fa fa-bars"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="header-btm">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <nav class="navbar navbar-expand-lg navbar-light">
                        <div class="header-logo">
                            <a href="#"><img src="image/logo.png" alt="logo"></a>
                        </div>
                        <div class="collapse navbar-collapse" id="navbarSupportedContent">
                            <ul class="navbar-nav">
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggler" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Home<i class="fa fa-angle-down"></i><i class="fa fa-angle-right"></i></a>
                                    <div class="sub-menu dropdown-menu">
                                        <ul class="all-menu">
                                            <li><a href="index.html">Home Page 1</a></li>
                                            <li><a href="index-2.html">Home Page 2</a></li>
                                            <li><a href="index-3.html">Home Page 3</a></li>
                                            <li><a href="index-4.html">Home Page 4</a></li>
                                            <li><a href="index-5.html">Home Page 5</a></li>
                                            <li><a href="index-6.html">Home Page 6</a></li>
                                        </ul>
                                    </div>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="about-us.html">About us</a>
                                </li>
                                <li class="dropdown">
                                    <a class="nav-link dropdown-toggler" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Pages<i class="fa fa-angle-down"></i><i class="fa fa-angle-right"></i></a>
                                    <div class="sub-menu dropdown-menu">
                                        <ul class="all-menu">
                                            <li><a href="error-404.html">404 Page</a></li>
                                            <li><a href="faq.html">Faq</a></li>
                                            <li><a href="coming-soon.html">Coming Soon</a></li>
                                        </ul>
                                    </div>
                                </li>
                                <li class="active">
                                    <a class="nav-link dropdown-toggler" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Shop<i class="fa fa-angle-down"></i><i class="fa fa-angle-right"></i></a>
                                    <div class="sub-menu mega-menu dropdown-menu">
                                        <ul class="d-lg-flex">
                                            <li class="submenu-links dropdown col-lg-3">
                                                <a href="#" class="menu-title dropdown-toggler" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Shop Pages<i class="fa fa-angle-down"></i><i class="fa fa-angle-right"></i></a>
                                                <ul class="all-menu dropdown-menu">
                                                    <li><a href="shop-list.html">Shop List View</a></li>
                                                    <li><a href="shop-grid.html">Shop Grid View</a></li>
                                                    <li><a href="shop-three-columns.html">shop 3 Column</a></li>
                                                    <li><a href="shop-four-columns.html">shop 4 Column</a></li>
                                                    <li><a href="shop-left-sidebar.html">shop Left Sidebar</a></li>
                                                    <li><a href="shop-right-sidebar.html">shop Right Sidebar</a></li>
                                                </ul>
                                            </li>
                                            <li class="submenu-links dropdown col-lg-3">
                                                <a href="#" class="menu-title dropdown-toggler" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Product Detail<i class="fa fa-angle-down"></i><i class="fa fa-angle-right"></i></a>
                                                <ul class="all-menu dropdown-menu">
                                                    <li><a href="product-detail.html">Product Default</a></li>
                                                    <li><a href="product-detail-left-sidebar.html">Product Left Sidebar</a></li>
                                                    <li><a href="product-detail-right-sidebar.html">Product Right Sidebar</a></li>
                                                </ul>
                                            </li>
                                            <li class="submenu-links dropdown col-lg-3">
                                                <a href="#" class="menu-title dropdown-toggler" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Extra<i class="fa fa-angle-down"></i><i class="fa fa-angle-right"></i></a>
                                                <ul class="all-menu dropdown-menu">
                                                    <li class="active"><a href="cart.html">Cart</a></li>
                                                    <li><a href="checkout.html">Checkout</a></li>
                                                    <li><a href="compare.html">Compare</a></li>
                                                    <li><a href="my-account.html">My Account</a></li>
                                                </ul>
                                            </li>
                                            <li class="submenu-img col-lg-3"><a href="#"><img src="image/header-banner.jpg" alt="banner"></a></li>
                                        </ul>
                                    </div>
                                </li>
                                <li class="dropdown">
                                    <a class="nav-link dropdown-toggler" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Blog<i class="fa fa-angle-down"></i><i class="fa fa-angle-right"></i></a>
                                    <div class="sub-menu dropdown-menu">
                                        <ul class="all-menu">
                                            <li><a class="dropdown-toggler" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Blog Layout<i class="fa fa-angle-down"></i><i class="fa fa-angle-right"></i></a>
                                                <div class="sub-menu dropdown-menu">
                                                    <ul class="all-menu">
                                                        <li><a href="blog-standard-fullwidth.html">Blog Standard Fullwidth</a></li> 
                                                        <li><a href="blog-standard-left-sidebar.html">Blog Standard Left Sidebar</a></li> 
                                                        <li><a href="blog-standard-right-sidebar.html">Blog Standard Right Sidebar</a></li> 
                                                        <li><a href="blog-three-columns.html">Blog 3 Columns </a></li>
                                                        <li><a href="blog-four-columns.html">Blog 4 Columns</a></li>
                                                        <li><a href="blog-grid-left-sidebar.html">Blog Grid Left Sidebar</a></li> 
                                                        <li><a href="blog-grid-right-sidebar.html">Blog Grid Right Sidebar</a></li> 
                                                    </ul>
                                                </div>
                                            </li>
                                            <li><a class="dropdown-toggler" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Blog Masonry<i class="fa fa-angle-down"></i><i class="fa fa-angle-right"></i></a>
                                                <div class="sub-menu dropdown-menu">
                                                    <ul class="all-menu">
                                                        <li><a href="blog-masonry-three-columns.html">Masonry 3 Columns</a></li> 
                                                        <li><a href="blog-masonry-four-columns.html">Masonry 4 Columns</a></li> 
                                                        <li><a href="blog-masonry-left-sidebar.html">Masonry Left Sidebar </a></li>
                                                        <li><a href="blog-masonry-right-sidebar.html">Masonry Right Sidebar</a></li>
                                                    </ul>
                                                </div>
                                            </li>
                                            <li><a class="dropdown-toggler" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Blog List<i class="fa fa-angle-down"></i><i class="fa fa-angle-right"></i></a>
                                                <div class="sub-menu dropdown-menu">
                                                    <ul class="all-menu">
                                                        <li><a href="blog-list-left-sidebar.html">List Left Sidebar </a></li>
                                                        <li><a href="blog-list-right-sidebar.html">List Right Sidebar</a></li>
                                                    </ul>
                                                </div>
                                            </li>
                                            <li><a class="dropdown-toggler" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Blog Single<i class="fa fa-angle-down"></i><i class="fa fa-angle-right"></i></a>
                                                <div class="sub-menu dropdown-menu">
                                                    <ul class="all-menu">
                                                        <li><a href="blog-detail.html">Default</a></li>
                                                        <li><a href="blog-detail-left-sidebar.html">Left Sidebar</a></li>
                                                        <li><a href="blog-detail-right-sidebar.html">Right Sidebar</a></li>
                                                        <li><a href="blog-detail-slider.html">Slider Post</a></li>
                                                        <li><a href="blog-detail-video.html">Video post</a></li>
                                                        <li><a href="blog-detail-audio.html">Audio Post</a></li>
                                                    </ul>
                                                </div>
                                            </li>
                                        </ul>
                                    </div>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="contact.html">Contact</a>
                                </li>
                            </ul>
                        </div>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</header> -->
<!-- End Header Section -->

<!-- Start Breadcrumbs Section -->
<section class="breadcrumbs-section background_bg" data-img-src="/user/image/cart-wallpaper.jpg">
	<div class="container">
    	<div class="row justify-content-center">
        	<div class="col-md-12">
                <div class="page_title text-center">
                	<h1>my cart</h1>
                    <ul class="breadcrumb justify-content-center">
                    	<li><a href="index.html">home</a></li>
                        <li><a href="#">shop</a></li>
                        <li><span>cart</span></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- End Header Section -->


<% if (cart && cart.length > 0) { %>
    <!-- Start Cart Section -->
    <section class="cart-section pt_large" id="reloadDiv">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <div class="cart-table table-responsive">
                        <table class="table table-bordered text-center">
                            <thead>
                                <tr class="row-1">
                                    <th class="row-title">Item</th>
                                    <th class="row-title">Product Name</th>
                                    <th class="row-title">Price</th>
                                    <th class="row-title">Quantity</th>
                                    <th class="row-title">Subtotal</th>
                                    <th class="row-title"></th>
                                </tr>
                            </thead>
                            <% cart.forEach((data) => { %>
                            <tbody>
                                <tr class="row-2">
                                    <td class="row-close close-1" data-title="product-remove"><a href="#"><i class="ion-close-circled"></i></a></td>
                                    <td class="row-img"><img src="images/products/<%= data.productId.images[0] %>" width="100px" alt="cart-img"></td>
                                    <td class="product-name" data-title="Product"><%= data.productId.productName %></td>
                                    <td class="product-price" data-title="Price">₹<%= data.productId.price %></td>
                                    <td>
                                        <div class="product_count">
                                            <button class="btn-quantity" onclick="cartCount('<%= data.productId._id %>', '<%= userId %>', -1)"><i class="fa fa-minus"></i></button>
                                            <input class="quantity-number qty" type="text" id="<%= data.productId._id %>" value="<%= data.quantity %>" min="1" max="10">
                                            <button class="btn-quantity" onclick="cartCount('<%= data.productId._id %>', '<%= userId %>', 1)"><i class="fa fa-plus"></i></button>
                                        </div>
                                    </td>
                                    <td class="product-total" data-title="Subprice">₹<%= data.totalPrice %></td>
                                    <td class="row-close close-2" data-title="product-remove">
                                        <button class="remove-btn" onclick="removeProduct('<%= data.productId._id %>')">Remove</button>
                                    </td>
                                </tr>
                            </tbody>
                            <% }) %>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    
        <div class="container">
            <div class="row justify-content-between">
                <div class="col-lg-4 col-md-6">
                    <div class="cart-inner-box box-1 text-center">
                        <div class="ci-title">
                            <h6>Promotional code</h6>
                        </div>
                        <div class="ci-caption">
                            <p>Enter Your Coupon Code If you have one</p>
                            <form>
                                <input required="" class="form-control" type="text" placeholder="Coupon Code">
                                <button class="btn btn-secondary" type="submit">Apply Coupon Code</button>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-6">
                    <div class="cart-inner-box box-2 text-center">
                        <div class="ci-title">
                            <h6>Cart Total</h6>
                        </div>
                        <div class="ci-caption">
                            <ul>
                                <li>Subtotal <span>₹<%= total %></span></li>
                                <li>Total <span>₹<%= total %></span></li>
                            </ul>
                        </div>
                        <div class="ci-btn">
                            <a href="checkout.html" class="btn btn-primary btn-block rounded-0">Proceed to Checkout</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
<% } else { %>
    <div class="error-content text-center">
        <dotlottie-player class="mx-auto d-block" src="https://lottie.host/5476084d-d6d5-4baf-b5a2-876d2628363b/8rll48Mwdf.json" background="transparent" speed="1" style="width: 300px; height: 300px;" loop autoplay></dotlottie-player>
        <h1 class="error-title">Nothing in Cart Yet!</h1>
        <p>Add Products to Cart</p>
        <a href="/shop"><button class="btn primary-btn">Continue Shopping</button></a>
    </div>
<% } %>

<!-- End Cart Box Section -->
<script>
function cartCount(productId, userId, count) {
    const quantityElement = document.getElementById(productId);
    const quantity = parseInt(quantityElement.value);
    count = parseInt(count);

    if (count === -1 && quantity === 1) {
        // Disable the "minus" button if the quantity is 1
        return;
    }

    fetch('/count-quantity', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            userId: userId,
            productId: productId,
            count: count,
            quantity: quantity,
        }),
    })
    .then(response => {
        if (response.ok) {
            $("#reloadDiv").load("/cart #reloadDiv, #cartTotal", function() {
                // Update total cart price after reloading
                const cartTotalElement = document.getElementById('cartTotal').value;
                if (cartTotalElement) {
                    const total = cartTotalElement.innerText;
                    console.log('Total Cart Price:', total);
                }
            });

            return response.json();
        }
        throw new Error('Network response was not ok.');
    })
    .then(data => {
        if (data) {
            const newQuantity = quantity + count;
            quantityElement.value = newQuantity;

            // Enable the "minus" button if the quantity is greater than 0
            const minusButton = quantityElement.previousElementSibling;
            if (minusButton) { // Check if the minusButton exists before accessing its style
                if (newQuantity <= 0) {
                    minusButton.style.pointerEvents = 'none';
                    minusButton.style.opacity = 0.5;
                } else {
                    minusButton.style.pointerEvents = 'auto';
                    minusButton.style.opacity = 1;
                }
            }
        } else if (data.check) {
            swal.fire({
                icon: "error",
                title: "Oops...",
                text: "Out of stock",
            });
        } else {
            swal.fire({
                position: "center",
                icon: "warning",
                text: response.message,
                timer: 1500,
                showConfirmButton: false,
            });
        }
    })
    .catch(error => {
        console.error('There was a problem with the fetch request:', error);
    });
}

</script>
<script>
    // const removeProduct = document.querySelector('.remove-btn')
    function removeProduct(productId) {
    fetch(`/cart/${productId}`, {
      method: 'DELETE',
      headers: {
        'Content-Type': 'application/json',
      },
    })
    .then(response => {
      if (response.ok) {
        return response.json();
      }
      throw new Error('Network response was not ok.');
    })
    .then(data => {
      console.log(data);

      document.querySelector('.row-2').remove();

      Swal.fire('Success', 'Product removed successfully!', 'success');
    })
    .catch(error => {
      console.error('There was a problem removing the product:', error);
      // Optionally show an error message or handle the error
      Swal.fire('Error', 'Failed to remove product.', 'error');
    });
  }
  </script>

<!-- <%-include ('../layouts/userFooter.ejs') %> -->

